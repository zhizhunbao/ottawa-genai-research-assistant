# 产品需求文档（PRD）

## 项目：渥太华市经济发展团队 GenAI 研究助手

------

## 🚧 **项目实施阶段说明**

### 当前状态：**阶段一 - 高保真原型 ✅ 已完成（2024年9月）**
✅ **已完成：**前端原型界面和用户体验验证  
✅ **已完成：**技术架构分析和用户认证需求评估  
✅ **已完成：**所有技术问题修复，零编译错误  
✅ **已完成：**Mock数据管理系统集成  
✅ **已完成：**利益相关者反馈收集和设计验证  
🚀 **状态：**项目完全可运行，可立即部署展示  
📋 **下一步：**用户认证系统实施和后端AI功能开发  

### 🔐 **用户认证需求分析（2024年9月）**
**分析状态：** ✅ **已完成**
- **用户基础设施：** 完整的用户管理模型已实现
- **安全框架：** JWT认证配置已就绪
- **基于角色的访问：** 多级权限系统已设计（研究员/分析师/管理员）
- **政府合规性：** 市政数据需要安全访问控制
- **建议：** **在AI后端集成前实施认证系统**

### 🎯 **阶段一成果总结**
- **技术质量**：零编译错误，所有功能正常运行
- **合规标准**：完全符合WCAG 2.1和双语要求
- **用户体验**：界面直观，交互流畅
- **扩展性**：为AI后端集成做好充分准备

------

## 1. 项目背景

渥太华市经济发展（Economic Development, ED）团队计划与阿岗昆学院 AI 课程合作，开发一个 **生成式 AI 研究助手**。
 该工具将允许市政府员工（以及未来可能的居民用户）通过自然语言提问，系统会从 **上传的 PDF 报告** 和 **ottawa.ca 网站公开信息** 中提取答案，并生成 **结构化的分析报告与可视化图表**。

该项目定位为 **概念验证（Proof of Concept, PoC）**，由学生在 **City Studio Program** 项目框架下主导开发。

**实施策略：分阶段开发**
1. **阶段一**：前端原型开发 ✅ **已完成**
2. **阶段二**：AI后端集成（计划中）
3. **阶段三**：生产环境部署（未来）

------

## 2. 项目目标

### 🎯 **阶段一目标（当前已达成）**
✅ 1. 创建符合政府标准的用户界面原型  
✅ 2. 验证无障碍（AoDA/WCAG）与双语（英语/法语）合规性  
✅ 3. 展示完整的用户体验流程  
✅ 4. 收集利益相关者反馈  

### 🔮 **最终目标（完整版本）**
1. 提供自然语言问答功能，简化数据查询流程。
2. 自动化生成基于 PDF/网站数据的分析报告与可视化结果。
3. 支持内部员工高效进行数据研究和决策参考。
4. 符合市政府对 **无障碍（AoDA/WCAG）** 与 **双语（英语/法语）** 的合规要求。
5. 验证 AI 在市政场景下的实际应用可行性。

------

## 3. 用户角色

- **市政府经济发展团队成员**
  - 需要快速查询与分析经济发展相关的报告和数据。
- **市政府其他部门员工（内部 PoC 阶段）**
  - 验证工具的通用性和扩展潜力。
- **居民用户（未来阶段）**
  - 通过网站/门户使用 AI 聊天机器人获取信息。

------

## 4. 用户场景（Use Cases）

### 🎭 **当前原型演示场景**

#### 场景 1：界面体验测试 ✅
- 用户：ED团队成员
- 操作：浏览所有页面，测试交互功能
- 输出：完整的UI/UX体验，模拟数据展示

#### 场景 2：无障碍功能验证 ✅
- 用户：有特殊需求的员工
- 操作：使用键盘导航、屏幕阅读器、高对比度模式
- 输出：确认符合WCAG 2.1标准

#### 场景 3：双语功能测试 ✅
- 用户：法语用户
- 操作：切换语言，验证所有界面元素
- 输出：完整的英法双语支持

### 🚀 **未来完整版本场景**

#### 场景 4：快速摘要（计划开发）
- 用户：经济发展团队成员
- 操作：上传一份季度《ED Update 报告》，输入「总结本季度主要经济趋势」。
- 输出：系统生成文字摘要 + 折线图显示季度变化趋势。

#### 场景 5：指标查询（计划开发）
- 用户：内部分析员
- 操作：输入「过去两年小企业贷款支持的总额」。
- 输出：系统生成表格 + 柱状图，附带文字说明。

#### 场景 6：政策问答（未来居民端）
- 用户：市民
- 操作：提问「我能申请哪些创业支持项目？」
- 输出：系统返回 FAQ 风格回答，并提供申请入口链接。

------

## 5. 功能需求实现状态

### 5.1 自然语言问答

**🎭 原型状态：** ✅ UI界面完成，模拟对话交互  
**🔮 完整版本：** 
- 输入框支持英文/法语。
- 返回文本答案（Markdown 格式）。
- 支持多轮对话（上下文保持）。

### 5.2 文档解析

**🎭 原型状态：** ✅ 上传界面完成，模拟处理流程  
**🔮 完整版本：**
- 上传 PDF，显示文件名与上传进度。
- 自动解析文本、表格、标题。
- 存入知识库，供后续查询使用。

### 5.3 报告生成

**🎭 原型状态：** ✅ 报告展示界面，模拟数据和图表  
**🔮 完整版本：**
- 自动生成 3 部分：摘要 / 数据分析 / 结论。
- 支持导出为 PDF、Word。
- 报告内嵌图表。

### 5.4 数据可视化

**🎭 原型状态：** ✅ 图表展示组件，使用模拟数据  
**🔮 完整版本：**
- 常用图表类型：柱状图、折线图、饼图。
- 图表与文字回答同时返回。
- 支持下载图表为 PNG。

### 5.5 无障碍与合规

**🎭 原型状态：** ✅ **已完全实现** 
- ✅ 符合 WCAG 2.1 标准（对比度、键盘可操作）。
- ✅ 支持屏幕阅读器。
- ✅ 全站语言切换按钮（EN / FR）。

------

## 6. 页面原型范围与元素说明

### ✅ **已实现页面（当前原型）**

#### 页面 1：首页 ✅
- ✅ Logo + 项目标题
- ✅ 功能特性展示卡片
- ✅ 快速入口 → 聊天界面
- ✅ 现代化响应式设计

#### 页面 2：聊天界面 ✅
- ✅ 清晰的对话区域
- ✅ 问题输入框 + 发送按钮
- ✅ 答案展示（支持Markdown）
- ✅ 模拟图表展示
- ✅ 复制、分享、反馈功能

#### 页面 3：文档上传页 ✅
- ✅ 文件上传按钮（支持拖拽）
- ✅ 文件列表展示
- ✅ 上传进度指示器
- ✅ 使用指南和最佳实践

#### 页面 4：报告生成页 ✅
- ✅ 报告标题和结构
- ✅ 报告内容区（摘要 / 分析 / 结论）
- ✅ 图表区域（多种图表类型）
- ✅ 导出按钮界面

#### 页面 5：设置页 ✅
- ✅ 语言切换（EN/FR）
- ✅ 主题选择（浅色/深色/自动）
- ✅ 无障碍选项（字体大小、对比度）
- ✅ 动画减弱选项

------

## 7. 功能交互流程（Flow）

### 🎭 **当前原型流程**
1. ✅ 用户浏览首页 → 选择功能 → 体验各个页面
2. ✅ 用户在聊天界面提问 → 系统返回模拟答案 + 图表
3. ✅ 用户测试文档上传 → 查看上传界面和进度展示
4. ✅ 用户访问报告页面 → 查看分析报告模板
5. ✅ 用户在设置页调整偏好 → 验证无障碍功能

### 🚀 **未来完整版本流程**
1. 用户上传 PDF → 系统解析 → 存入知识库。
2. 用户在聊天界面提问 → 系统查询知识库 → 返回真实答案 + 图表。
3. 用户可选择「生成报告」 → 系统输出摘要 + 图表 + 结论 → 可导出。
4. 用户可在设置页切换语言或启用无障碍模式。

------

## 8. 数据输入输出

### 🎭 **当前原型**
- **输入**：用户交互测试
- **输出**：模拟数据展示、界面响应

### 🚀 **未来完整版本**
- **输入**：
  - PDF 文件
  - 用户问题（英文/法语）
- **输出**：
  - 文本回答（Markdown 格式）
  - 可视化图表（PNG/SVG/HTML）
  - 报告文件（PDF/Word）

------

## 9. 非功能性需求

### ✅ **已验证（原型阶段）**
- **无障碍性**：完全符合 WCAG 2.1 AA 标准
- **双语支持**：英法文界面完整翻译
- **响应式设计**：支持移动端和桌面端
- **用户体验**：现代化、直观的界面设计

### 🔮 **待实现（完整版本）**
- **性能**：
  - 文本问答 < 3 秒
  - 图表/报告生成 < 7 秒
- **安全性**：
  - 仅使用公开数据
  - 不存储用户隐私信息
- **扩展性**：
  - 后续可接入数据库 / API

------

## 10. 成功标准

### ✅ **阶段一成功标准（已达成）**
- ✅ 交付可运行的高保真原型
- ✅ 符合双语与无障碍的基本要求
- ✅ 获得利益相关者积极反馈
- ✅ 验证设计方向和用户体验

### 🎯 **最终成功标准**
- 在课程周期内交付一个可运行的完整PoC
- 至少能支持 10 份现有 ED 报告的问答与分析
- 符合双语与无障碍的全部要求
- 通过市政府安全和合规审查

------

## 11. 安全与认证需求

### 🔐 **用户认证系统**

#### **为什么需要认证：**
1. **政府安全标准** - 市政数据需要受控访问
2. **文档安全性** - 上传的报告可能包含敏感的政府信息
3. **用户责任追踪** - 跟踪文档上传和报告生成活动
4. **个性化体验** - 用户偏好和聊天历史管理
5. **基于角色的访问控制** - 研究员、分析师和管理员的不同权限

#### **现有基础设施（准备实施）：**
✅ **用户模型：** 完整的用户管理数据结构  
✅ **角色系统：** 三级访问控制（研究员/分析师/管理员）  
✅ **用户偏好：** 语言、主题和通知设置  
✅ **安全配置：** JWT密钥和会话超时设置  
✅ **用户存储库：** 用户管理的数据访问层  

#### **需要实施的组件：**

**阶段2A：认证API（优先级）**
```typescript
// 需要的API端点：
POST /api/v1/auth/login      // 用户登录
POST /api/v1/auth/logout     // 用户注销
POST /api/v1/auth/refresh    // 令牌刷新
GET  /api/v1/auth/me         // 当前用户信息
```

**阶段2B：前端认证**
```typescript
// 需要的组件：
- LoginPage.tsx              // 登录界面
- AuthContext.tsx            // 认证状态管理
- ProtectedRoute.tsx         // 路由保护
- UserProfile.tsx            // 用户资料管理
```

**阶段2C：授权中间件**
```python
# API保护装饰器：
@require_auth               # 需要认证
@require_role("researcher") # 基于角色的访问
@require_permission("upload") # 基于权限的访问
```

#### **用户角色与权限：**

| 角色 | 文档上传 | 聊天访问 | 报告生成 | 管理功能 |
|------|---------|---------|---------|---------|
| **研究员** | ✅ 是 | ✅ 是 | ✅ 基础报告 | ❌ 否 |
| **分析师** | ✅ 是 | ✅ 是 | ✅ 高级报告 | ❌ 否 |
| **管理员** | ✅ 是 | ✅ 是 | ✅ 所有报告 | ✅ 是 |

#### **安全功能：**
- **会话管理：** 60分钟超时，支持刷新
- **访问日志：** 跟踪所有文档上传和查询
- **数据隔离：** 用户只能看到自己的聊天历史和上传文档
- **政府合规：** 满足市政IT安全要求

#### **实施策略：**
1. **简化启动：** 基于用户名的登录（内部工具无需密码）
2. **预配置用户：** 使用现有的`monk/users/users.json`用户数据库
3. **会话存储：** 简单会话管理，无需复杂的JWT刷新
4. **渐进增强：** 在未来阶段添加密码认证

### 🔒 **数据安全与隐私**

#### **文档安全：**
- **访问控制：** 只有认证用户可以上传/查看文档
- **用户隔离：** 文档与特定用户账户关联
- **审计跟踪：** 记录所有文档访问和处理活动

#### **聊天历史安全：**
- **用户专属：** 每个用户都有隔离的聊天历史
- **基于会话：** 聊天历史与认证会话绑定
- **数据保留：** 可配置的聊天数据保留策略

------

## 📅 **开发里程碑**

### 已完成 ✅
- **2024年9月**: 高保真前端原型
- **2024年9月**: Render云部署就绪
- **2024年9月**: 用户认证需求分析

### 计划中 🔄
- **2024年10月**: 用户认证系统实施
- **2024年10月**: AI后端开发开始
- **2024年11月**: PDF解析功能集成
- **2024年12月**: 完整系统集成测试

### 未来计划 📋
- **2025年Q1**: 生产环境部署
- **2025年Q2**: 用户培训和推广