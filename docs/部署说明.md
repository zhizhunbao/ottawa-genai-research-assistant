# Ottawa GenAI 研究助手 - 部署说明

## 概述

本项目是一个全栈的 AI 研究助手应用，包含：
- **前端**：React + TypeScript 单页应用
- **后端**：Python FastAPI 服务
- **部署**：使用 Render Blueprint 一键部署

## 部署方式

### 1. Render Blueprint 部署（推荐）

Render Blueprint 可以一次性部署整个应用栈，包括前端和后端服务。

#### 前置条件
- GitHub/GitLab 代码仓库
- Render 账户

#### 部署步骤

1. **准备代码仓库**
   ```bash
   git add .
   git commit -m "准备部署"
   git push origin main
   ```

2. **在 Render 创建 Blueprint**
   - 登录 [Render Dashboard](https://dashboard.render.com)
   - 点击 "New" → "Blueprint"
   - 连接您的 GitHub/GitLab 仓库
   - 选择包含 `render.yaml` 的分支（通常是 `main`）

3. **配置环境变量**
   
   在 Render Dashboard 中为后端服务配置以下环境变量：
   ```
   # OpenAI API 配置
   OPENAI_API_KEY=your_openai_api_key_here
   OPENAI_BASE_URL=https://api.openai.com/v1
   
   # 应用配置
   ENVIRONMENT=production
   DEBUG=false
   
   # 跨域配置（前端域名）
   CORS_ORIGINS=https://your-frontend-url.onrender.com
   ```

4. **部署**
   - 点击 "Create Blueprint"
   - Render 会自动：
     - 构建前端静态文件
     - 启动后端 Python 服务
     - 配置域名和 HTTPS

#### 部署架构

```
render.yaml (根目录)
├── backend 服务
│   ├── 类型：web
│   ├── 运行时：Python 3.11
│   ├── 构建：pip install -r requirements.txt
│   └── 启动：uvicorn main:app --host 0.0.0.0 --port $PORT
└── frontend 服务
    ├── 类型：static
    ├── 构建：npm install && npm run build
    └── 发布：build/ 目录
```

#### 自动部署

配置完成后，每次推送代码到主分支都会自动触发重新部署：
```bash
git add .
git commit -m "更新功能"
git push origin main  # 自动触发部署
```

### 2. 本地开发部署

#### 后端启动
```bash
cd backend
pip install -r requirements.txt
uvicorn main:app --reload --port 8000
```

#### 前端启动
```bash
cd frontend
npm install
npm start
```

访问：
- 前端：http://localhost:3000
- 后端：http://localhost:8000
- API 文档：http://localhost:8000/docs

## 环境变量配置

### 后端环境变量 (.env)
```bash
# OpenAI API 配置
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_BASE_URL=https://api.openai.com/v1

# 应用配置
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# 跨域配置
CORS_ORIGINS=http://localhost:3000,https://your-domain.com

# 上传配置
MAX_FILE_SIZE=10485760  # 10MB
UPLOAD_DIR=./uploads
```

### 前端环境变量 (.env)
```bash
# API 服务地址
REACT_APP_API_URL=http://localhost:8000

# 生产环境
# REACT_APP_API_URL=https://your-backend-url.onrender.com
```

## 配置文件说明

### render.yaml
根目录的 Blueprint 配置文件，定义了整个应用的部署架构：

```yaml
services:
  - type: web
    name: ottawa-genai-backend
    runtime: python3
    buildCommand: pip install -r backend/requirements.txt
    startCommand: cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT
    
  - type: static
    name: ottawa-genai-frontend
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: frontend/build
```

## 故障排查

### 常见问题

1. **构建失败**
   - 检查 `requirements.txt` 和 `package.json` 依赖
   - 查看 Render 构建日志

2. **API 连接失败**
   - 确认前端 `REACT_APP_API_URL` 配置正确
   - 检查后端 CORS 设置

3. **环境变量问题**
   - 在 Render Dashboard 中检查环境变量设置
   - 确保敏感信息不要提交到代码仓库

4. **部署超时**
   - 检查构建命令是否正确
   - 确认依赖安装没有卡住

### 日志查看

在 Render Dashboard 中：
- 选择对应的服务
- 点击 "Logs" 查看实时日志
- 查看构建和运行时错误信息

## 更新部署

### 代码更新
```bash
git add .
git commit -m "功能更新"
git push origin main
```

### 手动重新部署
在 Render Dashboard 中：
- 选择服务
- 点击 "Manual Deploy" → "Deploy latest commit"

## 监控和维护

### 服务监控
- Render 提供内置的服务监控和告警
- 可以设置自定义域名和 SSL 证书
- 支持自动扩容和负载均衡

### 备份建议
- 定期备份重要数据
- 使用 Git 管理代码版本
- 保存环境变量配置的备份

## 成本优化

### Render 免费额度
- 静态网站：免费
- Web 服务：每月 750 小时免费额度
- 超出后按使用量计费

### 优化建议
- 使用 Blueprint 统一管理可以减少重复资源
- 合理配置服务规格
- 监控使用量避免超额费用

## 技术支持

如果遇到部署问题：
1. 查看本文档的故障排查部分
2. 检查 Render 官方文档
3. 查看项目的 GitHub Issues
4. 联系项目维护者

---

**注意**：首次部署可能需要 5-10 分钟，请耐心等待。部署完成后，Render 会提供访问链接。 