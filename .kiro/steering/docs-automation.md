---
inclusion: always
---

# 文档自动化管理规则

## 核心原则

### 1. 文档即代码 (Docs as Code)
- 所有文档都应从源代码自动生成
- 使用版本控制管理文档变更
- 文档与代码同步更新
- 代码审查流程包含文档审查

### 2. 单一数据源 (Single Source of Truth)
- package.json - 脚本、依赖、项目信息的权威来源
- .env.example - 环境变量配置的权威来源
- 源代码 - 架构和 API 的权威来源
- 避免手动维护可能过时的文档

### 3. 自动化优先
- 优先使用脚本和工具自动生成文档
- 减少手动维护的工作量和出错概率
- 建立自动化的文档验证流程
- 定期检查文档的时效性

## 文档结构标准

### 必需文件
```
README.md                    # 项目概览和快速开始
docs/CODEMAPS/INDEX.md      # 架构总览
docs/GUIDES/setup.md        # 详细设置指南
```

### 推荐文件
```
CONTRIBUTING.md             # 贡献指南
CHANGELOG.md               # 变更日志
docs/GUIDES/api.md         # API 参考
docs/GUIDES/deployment.md  # 部署指南
```

### 自动生成文件
```
docs/CODEMAPS/             # 代码地图 (自动生成)
├── frontend.md            # 前端架构
├── backend.md             # 后端架构
├── database.md            # 数据库结构
└── integrations.md        # 外部集成

docs/REPORTS/              # 生成报告
├── codemap-diff.txt       # 代码地图变更
├── doc-validation.txt     # 文档验证结果
└── link-check.txt         # 链接检查结果
```

## 质量标准

### 内容质量
- 所有代码示例必须可执行
- 所有链接必须有效
- 文档必须包含最后更新时间戳
- 架构图必须反映实际代码结构

### 格式规范
- 遵循统一的 Markdown 格式
- 使用一致的标题层级
- 规范的代码块格式
- 正确的内部链接引用

### 时效性保证
- 每个文档包含生成时间戳
- 定期检查和更新过时内容
- 变更超过 30% 时主动提醒

## 更新触发条件

### 必须更新文档的情况
- 新增或删除主要功能
- API 接口变更
- 依赖项重大更新 (package.json 变更)
- 项目结构调整 (新增/删除目录)
- 环境变量变更 (.env.example 更新)

### 建议更新文档的情况
- 配置文件变更
- 小的功能改进
- 代码重构 (不影响 API)
- 文档格式优化

## 自动化工作流

### 1. 代码变更触发
当以下文件变更时，自动检查文档更新需求：
- `src/**/*.{ts,tsx,js,jsx,py}`
- `package.json`
- `.env.example`
- `README.md`

### 2. 定期维护
- 每周检查文档时效性
- 每月全面更新代码地图
- 每季度进行文档质量审计

### 3. 发布前检查
- 验证所有文档链接有效
- 确保代码示例可运行
- 检查架构图与实际代码一致
- 更新版本相关信息

## 工具集成

### Kiro 命令
```bash
# 生成代码地图
kiro docs:generate

# 更新文档
kiro docs:update

# 验证文档
kiro docs:validate

# 启动文档服务器
kiro docs:serve
```

### 自动化脚本
```
.kiro/scripts/
├── generate-codemaps.js    # 代码地图生成
├── update-docs.js          # 文档更新
├── validate-docs.js        # 文档验证
└── serve-docs.js           # 文档服务器
```

### Hook 集成
- 文件变更时自动检查文档更新需求
- 提交前验证文档质量
- 定期触发文档维护任务

## 错误处理策略

### 常见问题及解决方案

#### 文档与代码不同步
- **检测**: 定期比较文档时间戳与代码修改时间
- **解决**: 自动重新生成相关文档
- **预防**: 建立代码变更时的文档更新机制

#### 链接失效
- **检测**: 定期运行链接检查工具
- **解决**: 生成失效链接报告，提供修复建议
- **预防**: 优先使用相对路径和内部链接

#### 代码示例过时
- **检测**: 尝试执行文档中的代码示例
- **解决**: 从最新代码重新提取示例
- **预防**: 从实际测试代码中提取示例

#### 架构图不准确
- **检测**: 比较架构图与实际代码结构
- **解决**: 重新分析代码结构生成架构图
- **预防**: 从代码自动生成架构图

## 团队协作

### 文档责任
- 每个功能模块指定文档维护责任人
- 代码审查时同时审查相关文档
- 新功能开发时同步更新文档

### 知识共享
- 定期分享文档最佳实践
- 建立文档模板和标准
- 培训团队成员使用文档工具

### 反馈机制
- 收集用户对文档的反馈
- 定期评估文档的有效性
- 持续改进文档流程

## 性能优化

### 生成效率
- 增量更新而非全量重新生成
- 缓存分析结果避免重复计算
- 并行处理多个文档生成任务

### 存储优化
- 定期清理过时的报告文件
- 压缩大型架构图和资源文件
- 使用 Git LFS 管理大型文档资源

### 访问优化
- 建立文档索引提高搜索效率
- 使用 CDN 加速文档访问
- 实现文档的懒加载机制

---

**记住**: 好的文档不仅是信息的载体，更是团队协作和知识传承的重要工具。通过自动化管理，我们确保文档始终准确、及时、有用。
