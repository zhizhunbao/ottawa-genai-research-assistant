# Step 9: ä»£ç å®¡æŸ¥

## é˜¶æ®µä¿¡æ¯

- **é˜¶æ®µ**: `review` - ä»£ç å®¡æŸ¥
- **Skill**: `dev-code_reviewer`
- **è¾“å…¥**: `backend/`, `frontend/`, `backend/tests/`
- **äº§å‡ºç‰©**: `docs/review-report.md`

---

## æ‰§è¡Œæ­¥éª¤

### 1. åŠ è½½ä¸Šä¸‹æ–‡

è¯»å–å¹¶åˆ†æï¼š

- `docs/architecture/system-architecture.md` - æ¶æ„è§„èŒƒ
- `docs/sprints/Sprint_Plan_Ottawa_GenAI_Research_Assistant.md` - åŠŸèƒ½éœ€æ±‚
- `backend/app/` - åç«¯æºä»£ç 
- `frontend/src/` - å‰ç«¯æºä»£ç 
- `backend/tests/` - æµ‹è¯•ä»£ç 

### 2. åŠ è½½ Skill

åŠ è½½ `dev-code_reviewer` skillï¼Œè·å–ä»£ç å®¡æŸ¥ä¸“ä¸šçŸ¥è¯†ã€‚

### 3. ğŸ¯ è„šæœ¬æŸ¥æ‰¾ (Template-First)

**åœ¨å®¡æŸ¥ä¹‹å‰ï¼Œå…ˆè¿è¡Œè‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬ï¼š**

| è„šæœ¬                 | å‘½ä»¤                                                      | ç”¨é€”               |
| -------------------- | --------------------------------------------------------- | ------------------ |
| `env_check.py`       | `python .agent/scripts/env_check.py --files`              | æ£€æŸ¥é…ç½®æ–‡ä»¶å®Œæ•´æ€§ |
| `coverage_report.py` | `python .agent/scripts/coverage_report.py --threshold 80` | éªŒè¯æµ‹è¯•è¦†ç›–ç‡     |
| `extract_i18n.py`    | `python .agent/scripts/extract_i18n.py --check`           | æ£€æŸ¥ç¼ºå¤±çš„ç¿»è¯‘é”®   |

è¿è¡Œé¡ºåºï¼š

1. å…ˆè¿è¡Œä¸Šè¿°è„šæœ¬ï¼Œæ”¶é›†è‡ªåŠ¨åŒ–æ£€æŸ¥ç»“æœ
2. å°†è„šæœ¬ç»“æœçº³å…¥å®¡æŸ¥æŠ¥å‘Š
3. å†æ‰§è¡Œäººå·¥å®¡æŸ¥ç»´åº¦

### 4. å®¡æŸ¥ç»´åº¦

| ç»´åº¦           | æƒé‡ | è¯´æ˜             |
| -------------- | ---- | ---------------- |
| **åŠŸèƒ½æ­£ç¡®æ€§** | 30%  | æ˜¯å¦æ»¡è¶³éœ€æ±‚     |
| **ä»£ç è´¨é‡**   | 25%  | å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ |
| **å®‰å…¨æ€§**     | 20%  | å®‰å…¨æ¼æ´æ£€æŸ¥     |
| **æ€§èƒ½**       | 15%  | æ€§èƒ½é—®é¢˜æ£€æŸ¥     |
| **æµ‹è¯•è¦†ç›–**   | 10%  | æµ‹è¯•å……åˆ†æ€§       |

### 4. è‡ªåŠ¨åŒ–æ£€æŸ¥

è¿è¡Œè‡ªåŠ¨åŒ–å·¥å…·ï¼š

```bash
# åç«¯ä»£ç é£æ ¼
cd backend && uv run ruff check app/

# å‰ç«¯ä»£ç é£æ ¼
cd frontend && npm run lint

# åç«¯ç±»å‹æ£€æŸ¥
cd backend && uv run mypy app/ --ignore-missing-imports

# å‰ç«¯ç±»å‹æ£€æŸ¥
cd frontend && npx tsc --noEmit

# å®‰å…¨æ‰«æ
cd frontend && npm audit
cd backend && uv run pip-audit
```

### 5. å®‰å…¨å®¡æŸ¥

#### 5.1 OWASP Top 10 æ£€æŸ¥

- [ ] **æ³¨å…¥æ”»å‡»** - SQL/NoSQL/å‘½ä»¤æ³¨å…¥
- [ ] **è®¤è¯ç¼ºé™·** - å¼±å¯†ç ã€ä¼šè¯ç®¡ç†
- [ ] **æ•æ„Ÿæ•°æ®æ³„éœ²** - åŠ å¯†ã€ä¼ è¾“å®‰å…¨
- [ ] **XXE** - XML å¤–éƒ¨å®ä½“
- [ ] **è®¿é—®æ§åˆ¶** - æƒé™æ£€æŸ¥
- [ ] **å®‰å…¨é…ç½®é”™è¯¯** - é»˜è®¤é…ç½®
- [ ] **XSS** - è·¨ç«™è„šæœ¬
- [ ] **ååºåˆ—åŒ–** - ä¸å®‰å…¨çš„ååºåˆ—åŒ–
- [ ] **ç»„ä»¶æ¼æ´** - å·²çŸ¥æ¼æ´ç»„ä»¶
- [ ] **æ—¥å¿—ç›‘æ§** - æ—¥å¿—å’Œç›‘æ§ä¸è¶³

#### 5.2 æ•æ„Ÿä¿¡æ¯æ£€æŸ¥

```bash
# æ£€æŸ¥ç¡¬ç¼–ç å¯†é’¥
grep -r "password\|secret\|api_key" backend/app/ --include="*.py"
grep -r "password\|secret\|api_key" frontend/src/ --include="*.ts" --include="*.tsx"

# æ£€æŸ¥ .env æ–‡ä»¶
test -f backend/.env && echo "è­¦å‘Š: .env æ–‡ä»¶å­˜åœ¨ï¼Œç¡®ä¿å·²åŠ å…¥ .gitignore"
```

### 6. æ€§èƒ½å®¡æŸ¥

#### 6.1 åç«¯æ€§èƒ½

- [ ] N+1 æŸ¥è¯¢é—®é¢˜
- [ ] ç¼ºå°‘æ•°æ®åº“ç´¢å¼•
- [ ] å¤§é‡å†…å­˜åˆ†é…
- [ ] é˜»å¡æ“ä½œ
- [ ] ç¼ºå°‘ç¼“å­˜

#### 6.2 å‰ç«¯æ€§èƒ½

- [ ] å¤§å‹ Bundle
- [ ] æœªä¼˜åŒ–å›¾ç‰‡
- [ ] ç¼ºå°‘æ‡’åŠ è½½
- [ ] ä¸å¿…è¦çš„é‡æ¸²æŸ“
- [ ] å†…å­˜æ³„æ¼

### 7. ä»£ç è´¨é‡å®¡æŸ¥

#### 7.1 å‘½åè§„èŒƒ

```
âœ“ å˜é‡åè¯­ä¹‰æ¸…æ™°
âœ“ å‡½æ•°åæè¿°è¡Œä¸º
âœ“ ç±»åä½¿ç”¨åè¯
âœ“ å¸¸é‡ä½¿ç”¨å¤§å†™
```

#### 7.2 ä»£ç ç»“æ„

```
âœ“ å‡½æ•°é•¿åº¦ < 50 è¡Œ
âœ“ ç±»é•¿åº¦ < 300 è¡Œ
âœ“ æ–‡ä»¶é•¿åº¦ < 500 è¡Œ
âœ“ å¾ªç¯åµŒå¥— < 3 å±‚
âœ“ åœˆå¤æ‚åº¦ < 10
```

#### 7.3 æœ€ä½³å®è·µ

```
âœ“ DRY - æ— é‡å¤ä»£ç 
âœ“ SOLID åŸåˆ™
âœ“ é”™è¯¯å¤„ç†å®Œå–„
âœ“ æ—¥å¿—è®°å½•åˆç†
âœ“ æ³¨é‡Šæ¸…æ™°
```

### 8. é—®é¢˜åˆ†ç±»

| ä¸¥é‡æ€§      | è¯´æ˜                   | å¤„ç†     |
| ----------- | ---------------------- | -------- |
| ğŸ”´ Critical | å®‰å…¨æ¼æ´ã€æ•°æ®ä¸¢å¤±é£é™© | å¿…é¡»ä¿®å¤ |
| ğŸŸ  Major    | åŠŸèƒ½ç¼ºé™·ã€æ€§èƒ½é—®é¢˜     | åº”è¯¥ä¿®å¤ |
| ğŸŸ¡ Minor    | ä»£ç é£æ ¼ã€å°æ”¹è¿›       | å»ºè®®ä¿®å¤ |
| ğŸ”µ Info     | ä¿¡æ¯æç¤ºã€æ–‡æ¡£å»ºè®®     | å¯é€‰ä¿®å¤ |

### 9. ç”ŸæˆæŠ¥å‘Š

åˆ›å»º `docs/review-report.md`ï¼š

```markdown
# ä»£ç å®¡æŸ¥æŠ¥å‘Š

## æ¦‚è§ˆ

- å®¡æŸ¥æ—¥æœŸ: {date}
- ä»£ç ç‰ˆæœ¬: {commit_hash}
- å®¡æŸ¥èŒƒå›´: src/, tests/

## è¯„åˆ†

| ç»´åº¦       | å¾—åˆ†       | è¯´æ˜       |
| ---------- | ---------- | ---------- |
| åŠŸèƒ½æ­£ç¡®æ€§ | 9/10       | æ»¡è¶³éœ€æ±‚   |
| ä»£ç è´¨é‡   | 8/10       | è‰¯å¥½       |
| å®‰å…¨æ€§     | 9/10       | æ— ä¸¥é‡æ¼æ´ |
| æ€§èƒ½       | 7/10       | æœ‰ä¼˜åŒ–ç©ºé—´ |
| æµ‹è¯•è¦†ç›–   | 8/10       | è¦†ç›–ç‡è¾¾æ ‡ |
| **æ€»åˆ†**   | **82/100** | **é€šè¿‡**   |

## å‘ç°é—®é¢˜

### ğŸ”´ Critical (0)

æ— 

### ğŸŸ  Major (2)

1. **[BE-001] N+1 æŸ¥è¯¢é—®é¢˜**
   - æ–‡ä»¶: `src/backend/services/order_service.py:45`
   - æè¿°: å¾ªç¯ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
   - å»ºè®®: ä½¿ç”¨ joinedload é¢„åŠ è½½

2. **[FE-001] XSS é£é™©**
   - æ–‡ä»¶: `src/frontend/components/Comment.tsx:23`
   - æè¿°: ä½¿ç”¨ dangerouslySetInnerHTML
   - å»ºè®®: ä½¿ç”¨ DOMPurify æ¸…ç†

### ğŸŸ¡ Minor (5)

1. ...

### ğŸ”µ Info (3)

1. ...

## ä¿®å¤å»ºè®®

### å¿…é¡»ä¿®å¤ (é˜»æ–­å‘å¸ƒ)

- [ ] ä¿®å¤ N+1 æŸ¥è¯¢
- [ ] ä¿®å¤ XSS é£é™©

### å»ºè®®ä¿®å¤ (ä¸‹ä¸ªç‰ˆæœ¬)

- [ ] ä¼˜åŒ–å›¾ç‰‡åŠ è½½
- [ ] æ·»åŠ ç¼“å­˜

## ç»“è®º

ä»£ç æ•´ä½“è´¨é‡è‰¯å¥½ï¼Œéœ€ä¿®å¤ 2 ä¸ª Major é—®é¢˜åå¯å‘å¸ƒã€‚
```

### 10. é—®é¢˜ä¿®å¤

å¯¹äº Critical å’Œ Major é—®é¢˜ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Issue: [BE-001] N+1 æŸ¥è¯¢é—®é¢˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. å®šä½é—®é¢˜ä»£ç                             â”‚
â”‚  2. åº”ç”¨ä¿®å¤                                â”‚
â”‚  3. æ·»åŠ /æ›´æ–°æµ‹è¯•                           â”‚
â”‚  4. é‡æ–°å®¡æŸ¥                                â”‚
â”‚  5. æ ‡è®°å·²ä¿®å¤                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11. ç”¨æˆ·ç¡®è®¤

```
å®¡æŸ¥å‘ç°:
- ğŸ”´ Critical: 0
- ğŸŸ  Major: 2 (å·²ä¿®å¤)
- ğŸŸ¡ Minor: 5
- ğŸ”µ Info: 3

[C] ç¡®è®¤ - å®¡æŸ¥é€šè¿‡ï¼Œç»§ç»­ä¸‹ä¸€é˜¶æ®µ
[F] ä¿®å¤ - ç»§ç»­ä¿®å¤é—®é¢˜
[R] é‡å®¡ - é‡æ–°å®¡æŸ¥
```

---

## å®Œæˆæ£€æŸ¥

- [ ] è‡ªåŠ¨åŒ–æ£€æŸ¥é€šè¿‡
- [ ] å®‰å…¨å®¡æŸ¥é€šè¿‡
- [ ] Critical é—®é¢˜: 0
- [ ] Major é—®é¢˜å·²ä¿®å¤
- [ ] å®¡æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ

## çŠ¶æ€æ›´æ–°

```yaml
current_phase: deployment

phases:
  review:
    status: completed
    completed_at: "{current_time}"
    output: "docs/review-report.md"
```

## ä¸‹ä¸€æ­¥

â†’ è¿›å…¥ `step-10-deployment.md`
