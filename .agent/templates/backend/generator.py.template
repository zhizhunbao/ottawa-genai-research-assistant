"""
Content Generator

内容生成器模式：配置 → 生成
"""

from abc import ABC, abstractmethod
from dataclasses import dataclass
from typing import TypeVar, Generic, Any
from enum import Enum


class OutputFormat(Enum):
    TEXT = "text"
    MARKDOWN = "markdown"
    HTML = "html"
    JSON = "json"
    PDF = "pdf"
    IMAGE = "image"


@dataclass
class GeneratorConfig:
    """生成器配置"""
    format: OutputFormat = OutputFormat.MARKDOWN
    language: str = "en"
    options: dict | None = None


@dataclass
class GeneratedContent:
    """生成的内容"""
    content: Any
    format: OutputFormat
    metadata: dict | None = None


ConfigT = TypeVar("ConfigT", bound=GeneratorConfig)


class Generator(ABC, Generic[ConfigT]):
    """生成器基类"""

    def __init__(self, config: ConfigT | None = None):
        self.config = config or GeneratorConfig()

    @abstractmethod
    async def generate(self, data: Any) -> GeneratedContent:
        """生成内容"""
        pass

    async def format_output(self, content: Any) -> Any:
        """格式化输出"""
        return content


# ============================================
# Example: Report Generator
# ============================================

# @dataclass
# class ReportConfig(GeneratorConfig):
#     title: str = "Report"
#     include_summary: bool = True
#
#
# class ReportGenerator(Generator[ReportConfig]):
#     async def generate(self, data: Any) -> GeneratedContent:
#         # TODO: 生成报告
#         return GeneratedContent(
#             content="# Report\n...",
#             format=self.config.format,
#         )


# ============================================
# Example: Chart Generator
# ============================================

# @dataclass
# class ChartConfig(GeneratorConfig):
#     chart_type: str = "bar"
#     width: int = 800
#     height: int = 600
#
#
# class ChartGenerator(Generator[ChartConfig]):
#     async def generate(self, data: Any) -> GeneratedContent:
#         # TODO: 生成图表
#         return GeneratedContent(
#             content=b"<image bytes>",
#             format=OutputFormat.IMAGE,
#         )
