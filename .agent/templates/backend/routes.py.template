"""
{{feature_name}} 路由

定义 {{feature_name}} 相关的 API 端点。
Created: {{date}}
"""

from fastapi import APIRouter, Depends, HTTPException, status

from app.core.dependencies import get_db_session
from app.core.schemas import ApiResponse
from app.{{feature_name}}.schemas import (
    {{FeatureName}}Create,
    {{FeatureName}}Response,
    {{FeatureName}}Update,
    {{FeatureName}}List,
)
from app.{{feature_name}}.service import {{FeatureName}}Service

router = APIRouter(prefix="/api/v1/{{feature_name}}", tags=["{{feature_name}}"])


@router.get("", response_model=ApiResponse[{{FeatureName}}List])
async def list_{{feature_name}}(
    skip: int = 0,
    limit: int = 20,
    db=Depends(get_db_session),
) -> ApiResponse[{{FeatureName}}List]:
    """获取 {{feature_name}} 列表

    支持分页查询。
    """
    service = {{FeatureName}}Service(db)
    result = await service.list(skip=skip, limit=limit)
    return ApiResponse.ok(result)


@router.get("/{id}", response_model=ApiResponse[{{FeatureName}}Response])
async def get_{{feature_name}}(
    id: str,
    db=Depends(get_db_session),
) -> ApiResponse[{{FeatureName}}Response]:
    """获取单个 {{feature_name}}"""
    service = {{FeatureName}}Service(db)
    result = await service.get(id)
    if not result:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"{{FeatureName}} with id {id} not found",
        )
    return ApiResponse.ok(result)


@router.post("", response_model=ApiResponse[{{FeatureName}}Response], status_code=status.HTTP_201_CREATED)
async def create_{{feature_name}}(
    data: {{FeatureName}}Create,
    db=Depends(get_db_session),
) -> ApiResponse[{{FeatureName}}Response]:
    """创建新的 {{feature_name}}"""
    service = {{FeatureName}}Service(db)
    result = await service.create(data)
    return ApiResponse.ok(result)


@router.put("/{id}", response_model=ApiResponse[{{FeatureName}}Response])
async def update_{{feature_name}}(
    id: str,
    data: {{FeatureName}}Update,
    db=Depends(get_db_session),
) -> ApiResponse[{{FeatureName}}Response]:
    """更新 {{feature_name}}"""
    service = {{FeatureName}}Service(db)
    result = await service.update(id, data)
    if not result:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"{{FeatureName}} with id {id} not found",
        )
    return ApiResponse.ok(result)


@router.delete("/{id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_{{feature_name}}(
    id: str,
    db=Depends(get_db_session),
) -> None:
    """删除 {{feature_name}}"""
    service = {{FeatureName}}Service(db)
    deleted = await service.delete(id)
    if not deleted:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"{{FeatureName}} with id {id} not found",
        )
