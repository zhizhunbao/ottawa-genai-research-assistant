"""
Azure AI Search Service

实现 SearchService 协议。
"""

from typing import Optional

from azure.search.documents.aio import SearchClient
from azure.core.credentials import AzureKeyCredential

from .base import AzureServiceBase, SearchService
from .config import AzureSearchConfig
from .exceptions import SearchError


class AzureSearchService(AzureServiceBase, SearchService):
    """Azure AI Search 服务"""

    def __init__(
        self,
        config: AzureSearchConfig,
        embedding_fn: Optional[callable] = None,
    ):
        super().__init__("search")
        self._config = config
        self._embedding_fn = embedding_fn
        self._client = SearchClient(
            endpoint=config.endpoint,
            index_name=config.index_name,
            credential=AzureKeyCredential(config.api_key),
        )

    async def health_check(self) -> bool:
        # TODO: 验证索引存在
        pass

    async def query(
        self,
        text: str,
        top_k: int = 5,
        filters: Optional[dict] = None,
    ) -> list[dict]:
        # TODO: 文本搜索
        pass

    async def vector_search(
        self,
        vector: list[float],
        top_k: int = 5,
        filters: Optional[dict] = None,
    ) -> list[dict]:
        # TODO: 向量搜索
        pass

    async def hybrid_search(
        self,
        text: str,
        top_k: int = 5,
        filters: Optional[dict] = None,
    ) -> list[dict]:
        # TODO: 混合搜索 (文本 + 向量)
        pass

    async def index(self, documents: list[dict]) -> int:
        # TODO: 索引文档
        pass

    async def delete(self, ids: list[str]) -> int:
        # TODO: 删除文档
        pass

    async def close(self):
        await self._client.close()
