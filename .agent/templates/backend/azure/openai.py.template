"""
Azure OpenAI Service

实现 LLMService 协议。
"""

from typing import AsyncIterator, Optional

from openai import AsyncAzureOpenAI

from .base import AzureServiceBase, LLMService, with_retry
from .config import AzureOpenAIConfig
from .exceptions import OpenAIError, OpenAIRateLimitError


class AzureOpenAIService(AzureServiceBase, LLMService):
    """Azure OpenAI 服务"""

    def __init__(self, config: AzureOpenAIConfig):
        super().__init__("openai")
        self._config = config
        self._client = AsyncAzureOpenAI(
            azure_endpoint=config.endpoint,
            api_key=config.api_key,
            api_version=config.api_version,
        )

    async def health_check(self) -> bool:
        # TODO: 实现健康检查
        pass

    @with_retry(max_retries=3, exceptions=(OpenAIRateLimitError,))
    async def complete(
        self,
        messages: list[dict[str, str]],
        **kwargs,
    ) -> str:
        # TODO: 调用 chat.completions.create
        pass

    async def stream(
        self,
        messages: list[dict[str, str]],
        **kwargs,
    ) -> AsyncIterator[str]:
        # TODO: 流式输出
        pass

    async def embed(self, text: str) -> list[float]:
        # TODO: 调用 embeddings.create
        pass

    async def embed_batch(self, texts: list[str]) -> list[list[float]]:
        # TODO: 批量嵌入
        pass
