/**
 * DataDisplay Component
 *
 * 通用数据展示组件：表格/图表/代码/Markdown
 */

import { useMemo } from 'react';

type DisplayType = 'table' | 'chart' | 'code' | 'markdown' | 'json' | 'image';

interface DataDisplayProps {
  type: DisplayType;
  data: unknown;
  title?: string;
  className?: string;
}

export function DataDisplay({ type, data, title, className = '' }: DataDisplayProps) {
  const content = useMemo(() => {
    switch (type) {
      case 'table':
        return <TableView data={data as Record<string, unknown>[]} />;
      case 'chart':
        return <ChartView data={data} />;
      case 'code':
        return <CodeView data={data as string} />;
      case 'markdown':
        return <MarkdownView data={data as string} />;
      case 'json':
        return <JsonView data={data} />;
      case 'image':
        return <ImageView data={data as string} />;
      default:
        return <pre>{JSON.stringify(data, null, 2)}</pre>;
    }
  }, [type, data]);

  return (
    <div className={`rounded-lg border p-4 ${className}`}>
      {title && <h3 className="font-medium mb-2">{title}</h3>}
      {content}
    </div>
  );
}

// ============================================
// Sub-components
// ============================================

function TableView({ data }: { data: Record<string, unknown>[] }) {
  if (!data?.length) return <p>No data</p>;

  const columns = Object.keys(data[0]);

  return (
    <table className="w-full text-sm">
      <thead>
        <tr>
          {columns.map((col) => (
            <th key={col} className="text-left p-2 border-b">
              {col}
            </th>
          ))}
        </tr>
      </thead>
      <tbody>
        {data.map((row, i) => (
          <tr key={i}>
            {columns.map((col) => (
              <td key={col} className="p-2 border-b">
                {String(row[col] ?? '')}
              </td>
            ))}
          </tr>
        ))}
      </tbody>
    </table>
  );
}

function ChartView({ data }: { data: unknown }) {
  // TODO: 集成图表库 (recharts, etc.)
  return <div className="h-64 bg-muted rounded flex items-center justify-center">Chart: {JSON.stringify(data)}</div>;
}

function CodeView({ data }: { data: string }) {
  return (
    <pre className="bg-muted p-4 rounded overflow-x-auto">
      <code>{data}</code>
    </pre>
  );
}

function MarkdownView({ data }: { data: string }) {
  // TODO: 集成 markdown 渲染器
  return <div className="prose">{data}</div>;
}

function JsonView({ data }: { data: unknown }) {
  return (
    <pre className="bg-muted p-4 rounded overflow-x-auto text-sm">
      {JSON.stringify(data, null, 2)}
    </pre>
  );
}

function ImageView({ data }: { data: string }) {
  return <img src={data} alt="Generated" className="max-w-full rounded" />;
}
