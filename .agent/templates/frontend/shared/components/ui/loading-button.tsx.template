/**
 * LoadingButton - Button with loading spinner state and disabled interactions
 *
 * @module shared/components/ui/loading-button
 * @source bulletproof-react/apps/react-vite/src/components/ui/button/button.tsx + spinner pattern
 * @reference https://github.com/alan2207/bulletproof-react
 * @template S2-M1-F2
 *
 * Features:
 * - Spinner animation during loading state
 * - Automatic disabled state when loading
 * - Multiple variants: default, destructive, outline, secondary, ghost, link
 * - Multiple sizes: sm, md, lg, icon
 * - Children auto-hidden during loading (replaced by spinner + optional loadingText)
 * - Composable with any icon or content
 *
 * Usage:
 * ```tsx
 * <LoadingButton loading={isSubmitting} onClick={handleSubmit}>
 *   Save Changes
 * </LoadingButton>
 *
 * <LoadingButton
 *   loading={isDeleting}
 *   loadingText="Deleting..."
 *   variant="destructive"
 * >
 *   Delete
 * </LoadingButton>
 *
 * <LoadingButton loading={false} variant="outline" size="sm">
 *   <PlusIcon className="mr-2 h-4 w-4" /> Add Item
 * </LoadingButton>
 * ```
 */

import * as React from "react";

// ─── Types ───────────────────────────────────────────────────────────────────

export interface LoadingButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  /** Whether the button is in a loading state */
  loading?: boolean;
  /** Text to show during loading (replaces children) */
  loadingText?: string;
  /** Visual variant */
  variant?:
    | "default"
    | "destructive"
    | "outline"
    | "secondary"
    | "ghost"
    | "link";
  /** Button size */
  size?: "sm" | "md" | "lg" | "icon";
}

// ─── Spinner (inline — from bulletproof-react spinner.tsx) ────────────────────

const SpinnerIcon: React.FC<{ className?: string }> = ({ className = "" }) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    strokeWidth="2"
    strokeLinecap="round"
    strokeLinejoin="round"
    className={`animate-spin ${className}`}
    aria-hidden="true"
  >
    <path d="M21 12a9 9 0 1 1-6.219-8.56" />
  </svg>
);

// ─── Style Maps ──────────────────────────────────────────────────────────────

const variantStyles: Record<string, string> = {
  default: [
    "bg-[var(--color-primary)] text-[var(--color-primary-foreground)]",
    "hover:bg-[var(--color-primary)]/90",
    "shadow-sm",
  ].join(" "),
  destructive: [
    "bg-[var(--color-destructive)] text-[var(--color-destructive-foreground)]",
    "hover:bg-[var(--color-destructive)]/90",
    "shadow-sm",
  ].join(" "),
  outline: [
    "border border-[var(--color-border)] bg-[var(--color-background)]",
    "hover:bg-[var(--color-accent)] hover:text-[var(--color-accent-foreground)]",
    "shadow-sm",
  ].join(" "),
  secondary: [
    "bg-[var(--color-secondary)] text-[var(--color-secondary-foreground)]",
    "hover:bg-[var(--color-secondary)]/80",
    "shadow-sm",
  ].join(" "),
  ghost: [
    "hover:bg-[var(--color-accent)] hover:text-[var(--color-accent-foreground)]",
  ].join(" "),
  link: [
    "text-[var(--color-primary)] underline-offset-4 hover:underline",
  ].join(" "),
};

const sizeStyles: Record<string, string> = {
  sm: "h-8 px-3 text-xs rounded-md gap-1.5",
  md: "h-9 px-4 py-2 text-sm rounded-md gap-2",
  lg: "h-10 px-6 text-sm rounded-md gap-2",
  icon: "h-9 w-9 rounded-md",
};

const baseStyles = [
  "inline-flex items-center justify-center",
  "whitespace-nowrap font-medium",
  "focus-visible:outline-none focus-visible:ring-2",
  "focus-visible:ring-[var(--color-ring)] focus-visible:ring-offset-2",
  "disabled:pointer-events-none disabled:opacity-50",
  "transition-colors duration-200",
  "select-none",
].join(" ");

// ─── Component ───────────────────────────────────────────────────────────────

export const LoadingButton = React.forwardRef<
  HTMLButtonElement,
  LoadingButtonProps
>(
  (
    {
      loading = false,
      loadingText,
      variant = "default",
      size = "md",
      disabled,
      className = "",
      children,
      ...buttonProps
    },
    ref
  ) => {
    const spinnerSize = size === "sm" ? "h-3 w-3" : "h-4 w-4";

    return (
      <button
        ref={ref}
        type="button"
        disabled={disabled || loading}
        className={`${baseStyles} ${variantStyles[variant] || ""} ${
          sizeStyles[size] || ""
        } ${className}`}
        aria-busy={loading}
        {...buttonProps}
      >
        {loading ? (
          <>
            <SpinnerIcon className={spinnerSize} />
            {loadingText && <span>{loadingText}</span>}
          </>
        ) : (
          children
        )}
      </button>
    );
  }
);

LoadingButton.displayName = "LoadingButton";

export default LoadingButton;
