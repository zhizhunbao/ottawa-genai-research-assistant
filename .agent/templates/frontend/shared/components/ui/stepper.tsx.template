/**
 * Stepper Component - Multi-step form progress indicator
 *
 * @module frontend/shared/components/ui/stepper
 * @source ui-flowbite-lib/content/components/stepper.md (272L)
 * @reference https://flowbite.com/docs/components/stepper/
 * @template S6-M2-F2
 *
 * Stepper components for multi-step forms:
 * 1. HorizontalStepper — numbered steps with check icons
 * 2. VerticalStepper — card-based step list with status colors
 * 3. BreadcrumbStepper — chevron-separated inline stepper
 *
 * Key patterns from Flowbite:
 * - Ordered list semantic structure
 * - Check icon for completed, arrow for current, number for pending
 * - Color coding: brand for completed, neutral for pending
 * - Responsive: stacked on mobile, inline on desktop
 */

import React from "react";

// ─── Types ──────────────────────────────────────────────────────────────────

export type StepStatus = "completed" | "current" | "pending";

export interface Step {
  /** Step title (e.g., "Personal Info") */
  title: string;
  /** Optional subtitle */
  subtitle?: string;
  /** Optional icon element */
  icon?: React.ReactNode;
  /** Step status */
  status: StepStatus;
}

export interface StepperProps {
  steps: Step[];
  /** 'horizontal' (default), 'vertical', 'breadcrumb' */
  variant?: "horizontal" | "vertical" | "breadcrumb";
  /** Callback when a step is clicked */
  onStepClick?: (index: number) => void;
  className?: string;
}

// ─── Icons ──────────────────────────────────────────────────────────────────

function CheckIcon() {
  return (
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
      <polyline points="20 6 9 17 4 12" />
    </svg>
  );
}

function ArrowIcon() {
  return (
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" />
    </svg>
  );
}

function ChevronIcon() {
  return (
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <polyline points="7 16 11 12 7 8" /><polyline points="13 16 17 12 13 8" />
    </svg>
  );
}

// ─── Styles ─────────────────────────────────────────────────────────────────

const statusColors = {
  completed: {
    bg: "var(--color-success-soft, #dcfce7)",
    border: "var(--color-success-border, #86efac)",
    text: "var(--color-success, #16a34a)",
    iconBg: "var(--color-brand-soft, #e9e3ff)",
    iconColor: "var(--color-brand, #4318ff)",
  },
  current: {
    bg: "var(--color-brand-soft, #e9e3ff)",
    border: "var(--color-brand-border, #c4b5fd)",
    text: "var(--color-brand, #4318ff)",
    iconBg: "var(--color-brand, #4318ff)",
    iconColor: "#ffffff",
  },
  pending: {
    bg: "var(--bg-secondary, #f8fafc)",
    border: "var(--border-color, #e2e8f0)",
    text: "var(--text-secondary, #64748b)",
    iconBg: "var(--bg-tertiary, #f1f5f9)",
    iconColor: "var(--text-secondary, #64748b)",
  },
};

// ─── Horizontal Stepper ─────────────────────────────────────────────────────
// @source ui-flowbite-lib/content/components/stepper.md — Progress stepper (50-66L)

function HorizontalStepper({ steps, onStepClick, className }: StepperProps) {
  return (
    <ol
      style={{
        display: "flex",
        alignItems: "center",
        width: "100%",
        listStyle: "none",
        padding: 0,
        margin: 0,
        gap: "8px",
      }}
      className={className}
    >
      {steps.map((step, i) => {
        const colors = statusColors[step.status];
        const isLast = i === steps.length - 1;

        return (
          <li
            key={i}
            style={{
              display: "flex",
              alignItems: "center",
              flex: isLast ? "0 0 auto" : 1,
              cursor: onStepClick ? "pointer" : "default",
            }}
            onClick={() => onStepClick?.(i)}
          >
            <span
              style={{
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                width: "40px",
                height: "40px",
                borderRadius: "50%",
                background: colors.iconBg,
                color: colors.iconColor,
                flexShrink: 0,
                fontSize: "var(--text-sm, 14px)",
                fontWeight: 600,
              }}
            >
              {step.status === "completed" ? (
                <CheckIcon />
              ) : step.icon ? (
                step.icon
              ) : (
                i + 1
              )}
            </span>

            {step.subtitle ? (
              <span style={{ marginLeft: "12px" }}>
                <span
                  style={{
                    display: "block",
                    fontWeight: 500,
                    fontSize: "var(--text-sm, 14px)",
                    color: colors.text,
                    lineHeight: 1.3,
                  }}
                >
                  {step.title}
                </span>
                <span
                  style={{
                    display: "block",
                    fontSize: "var(--text-xs, 12px)",
                    color: "var(--text-secondary, #64748b)",
                  }}
                >
                  {step.subtitle}
                </span>
              </span>
            ) : null}

            {!isLast && (
              <div
                style={{
                  flex: 1,
                  height: "4px",
                  borderRadius: "2px",
                  background:
                    step.status === "completed"
                      ? "var(--color-brand-border, #c4b5fd)"
                      : "var(--border-color, #e2e8f0)",
                  marginLeft: "12px",
                }}
              />
            )}
          </li>
        );
      })}
    </ol>
  );
}

// ─── Vertical Stepper ───────────────────────────────────────────────────────
// @source ui-flowbite-lib/content/components/stepper.md — Vertical stepper (111-157L)

function VerticalStepper({ steps, onStepClick, className }: StepperProps) {
  return (
    <ol
      style={{
        display: "flex",
        flexDirection: "column",
        gap: "12px",
        listStyle: "none",
        padding: 0,
        margin: 0,
        width: "100%",
        maxWidth: "320px",
      }}
      className={className}
    >
      {steps.map((step, i) => {
        const colors = statusColors[step.status];
        return (
          <li
            key={i}
            style={{ cursor: onStepClick ? "pointer" : "default" }}
            onClick={() => onStepClick?.(i)}
          >
            <div
              style={{
                width: "100%",
                padding: "16px",
                background: colors.bg,
                border: `1px solid ${colors.border}`,
                borderRadius: "var(--radius-md, 8px)",
                color: colors.text,
              }}
              role="alert"
            >
              <div
                style={{
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "space-between",
                }}
              >
                <h3 style={{ fontWeight: 500, fontSize: "var(--text-sm, 14px)", margin: 0 }}>
                  {i + 1}. {step.title}
                </h3>
                {step.status === "completed" ? (
                  <CheckIcon />
                ) : step.status === "current" ? (
                  <ArrowIcon />
                ) : (
                  <ArrowIcon />
                )}
              </div>
              {step.subtitle && (
                <p
                  style={{
                    fontSize: "var(--text-xs, 12px)",
                    marginTop: "4px",
                    marginBottom: 0,
                    opacity: 0.8,
                  }}
                >
                  {step.subtitle}
                </p>
              )}
            </div>
          </li>
        );
      })}
    </ol>
  );
}

// ─── Breadcrumb Stepper ─────────────────────────────────────────────────────
// @source ui-flowbite-lib/content/components/stepper.md — Breadcrumb stepper (165-186L)

function BreadcrumbStepper({ steps, onStepClick, className }: StepperProps) {
  return (
    <ol
      style={{
        display: "flex",
        alignItems: "center",
        gap: "8px",
        padding: "12px 16px",
        background: "var(--bg-primary, #ffffff)",
        border: "1px solid var(--border-color, #e2e8f0)",
        borderRadius: "var(--radius-md, 8px)",
        boxShadow: "var(--shadow-sm, 0 1px 2px rgba(0,0,0,0.05))",
        listStyle: "none",
        margin: 0,
        flexWrap: "wrap" as const,
      }}
      className={className}
    >
      {steps.map((step, i) => {
        const colors = statusColors[step.status];
        const isLast = i === steps.length - 1;

        return (
          <li
            key={i}
            style={{
              display: "flex",
              alignItems: "center",
              gap: "8px",
              cursor: onStepClick ? "pointer" : "default",
              color: colors.text,
            }}
            onClick={() => onStepClick?.(i)}
          >
            <span
              style={{
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                width: "20px",
                height: "20px",
                borderRadius: "50%",
                border: `1px solid currentColor`,
                fontSize: "11px",
                fontWeight: 500,
                flexShrink: 0,
              }}
            >
              {i + 1}
            </span>
            <span style={{ fontSize: "var(--text-sm, 14px)", fontWeight: 500 }}>
              {step.title}
            </span>
            {!isLast && (
              <span style={{ color: "var(--text-secondary, #64748b)" }}>
                <ChevronIcon />
              </span>
            )}
          </li>
        );
      })}
    </ol>
  );
}

// ─── Stepper (Unified Export) ───────────────────────────────────────────────

export function Stepper({ variant = "horizontal", ...props }: StepperProps) {
  switch (variant) {
    case "vertical":
      return <VerticalStepper {...props} />;
    case "breadcrumb":
      return <BreadcrumbStepper {...props} />;
    default:
      return <HorizontalStepper {...props} />;
  }
}

// ─── Usage Example ──────────────────────────────────────────────────────────
//
// const steps: Step[] = [
//   { title: "Upload Document", subtitle: "Select files", status: "completed" },
//   { title: "Configure Pipeline", subtitle: "Set parameters", status: "current" },
//   { title: "Process & Index", subtitle: "RAG indexing", status: "pending" },
//   { title: "Review Results", status: "pending" },
// ];
//
// <Stepper steps={steps} />
// <Stepper steps={steps} variant="vertical" />
// <Stepper steps={steps} variant="breadcrumb" />

export default Stepper;
