from azure.identity.aio import (
    AzureDeveloperCliCredential,
    ManagedIdentityCredential,
    get_bearer_token_provider,
)
from typing import Optional, Union

async def create_azure_credential(
    running_on_azure: bool,
    tenant_id: Optional[str] = None,
    client_id: Optional[str] = None,
) -> Union[AzureDeveloperCliCredential, ManagedIdentityCredential]:
    """
    生产环境用 ManagedIdentity，开发环境用 AzureDeveloperCLI。
    参考: azure-search-openai-demo (app.py)
    """
    if running_on_azure:
        return ManagedIdentityCredential(client_id=client_id) if client_id \
            else ManagedIdentityCredential()
    elif tenant_id:
        return AzureDeveloperCliCredential(tenant_id=tenant_id, process_timeout=60)
    else:
        return AzureDeveloperCliCredential(process_timeout=60)

def create_token_provider(credential, scope: str = "https://cognitiveservices.azure.com/.default"):
    """
    提供统一的 token 获取接口。
    """
    return get_bearer_token_provider(credential, scope)
